<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="PROC_UPDATE_FACTURATION" id="810F3D56-6264-185C-2A7E-CA3E4667C37C" directorySegmentName="seg_0">
<sourceConnName>DEV57_AXIONEUSER_FACTU</sourceConnName>
<sourceObjSchema>AXIONEUSER_FACTU</sourceObjSchema>
<sourceObjName>PROC_UPDATE_FACTURATION</sourceObjName>
<createdBy>R.WATH</createdBy>
<createdTime>2012-12-04 10:06:38 UTC</createdTime>
<generatorID>Généré par l&apos;utilisateur</generatorID>
<ownerDesignName>ST-SYS-SIB-BD_FCTPRO-000009-8 MCD-FACTUPRO V4.5.0</ownerDesignName>
<owner>4FCC3A6A-181E-A36A-613B-7868309493E2</owner>
<source>CREATE OR REPLACE PROCEDURE                    AXIONEUSER_FACTU.PROC_UPDATE_FACTURATION (DATE_MOIS in date, LIGNE_SERVICE in varchar)  AS&lt;br/&gt;&lt;br/&gt;v_id_commande_sfr varchar2(20); &lt;br/&gt;v_nbpaires number;&lt;br/&gt;v_date_cmde date;&lt;br/&gt;&lt;br/&gt;cursor c1 is&lt;br/&gt;select via, id_fdsl_facturation from T_FDSL_FACTURATION&lt;br/&gt;where date_facturation = DATE_MOIS&lt;br/&gt;and nbpaires is null and id_commande_sfr is null &lt;br/&gt;and NOM_FAI = &apos;NEUF CEGETEL&apos;;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;for r1 in c1&lt;br/&gt;loop&lt;br/&gt;  &lt;br/&gt;  begin&lt;br/&gt;  select idcommande, nbpaires, date_cmde into v_id_commande_sfr, v_nbpaires, v_date_cmde&lt;br/&gt;  from S_TEMP_FOP_FACTU_SDSL where idexternedeg = r1.via&lt;br/&gt;  and rownum = 1;&lt;br/&gt;  &lt;br/&gt;  --dbms_output.put_line (v_id_commande_sfr ||&apos; &apos; || v_nbpaires ||&apos; &apos; ||r1.via);&lt;br/&gt;  &lt;br/&gt;  update T_FDSL_FACTURATION set id_commande_sfr = v_id_commande_sfr, nbpaires = v_nbpaires, date_cmde = v_date_cmde&lt;br/&gt;  where id_fdsl_facturation = r1.id_fdsl_facturation;&lt;br/&gt; &lt;br/&gt;  EXCEPTION&lt;br/&gt;     WHEN NO_DATA_FOUND THEN&lt;br/&gt;       NULL;&lt;br/&gt;  end;&lt;br/&gt;end loop;&lt;br/&gt;commit;&lt;br/&gt;&lt;br/&gt;delete from t_fdsl_facturation&lt;br/&gt;where profil=&apos;Ligne SDSL 500k-4M bipaire&apos;&lt;br/&gt;and code_charge=&apos;SDSL-ABO-2P&apos;&lt;br/&gt;--and type_charge=&apos;ABO&apos; &lt;br/&gt;and nom_fai = &apos;NEUF CEGETEL&apos;;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;END PROC_UPDATE_FACTURATION;</source>
<body>CREATE OR REPLACE PROCEDURE                    AXIONEUSER_FACTU.PROC_UPDATE_FACTURATION (DATE_MOIS in date, LIGNE_SERVICE in varchar)  AS&lt;br/&gt;&lt;br/&gt;v_id_commande_sfr varchar2(20); &lt;br/&gt;v_nbpaires number;&lt;br/&gt;v_date_cmde date;&lt;br/&gt;&lt;br/&gt;cursor c1 is&lt;br/&gt;select via, id_fdsl_facturation from T_FDSL_FACTURATION&lt;br/&gt;where date_facturation = DATE_MOIS&lt;br/&gt;and nbpaires is null and id_commande_sfr is null &lt;br/&gt;and NOM_FAI = &apos;NEUF CEGETEL&apos;;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;for r1 in c1&lt;br/&gt;loop&lt;br/&gt;  &lt;br/&gt;  begin&lt;br/&gt;  select idcommande, nbpaires, date_cmde into v_id_commande_sfr, v_nbpaires, v_date_cmde&lt;br/&gt;  from S_TEMP_FOP_FACTU_SDSL where idexternedeg = r1.via&lt;br/&gt;  and rownum = 1;&lt;br/&gt;  &lt;br/&gt;  --dbms_output.put_line (v_id_commande_sfr ||&apos; &apos; || v_nbpaires ||&apos; &apos; ||r1.via);&lt;br/&gt;  &lt;br/&gt;  update T_FDSL_FACTURATION set id_commande_sfr = v_id_commande_sfr, nbpaires = v_nbpaires, date_cmde = v_date_cmde&lt;br/&gt;  where id_fdsl_facturation = r1.id_fdsl_facturation;&lt;br/&gt; &lt;br/&gt;  EXCEPTION&lt;br/&gt;     WHEN NO_DATA_FOUND THEN&lt;br/&gt;       NULL;&lt;br/&gt;  end;&lt;br/&gt;end loop;&lt;br/&gt;commit;&lt;br/&gt;&lt;br/&gt;delete from t_fdsl_facturation&lt;br/&gt;where profil=&apos;Ligne SDSL 500k-4M bipaire&apos;&lt;br/&gt;and code_charge=&apos;SDSL-ABO-2P&apos;&lt;br/&gt;--and type_charge=&apos;ABO&apos; &lt;br/&gt;and nom_fai = &apos;NEUF CEGETEL&apos;;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;END PROC_UPDATE_FACTURATION;</body>
</StoredProcedureOraclev10g>